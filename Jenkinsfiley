pipeline {
    agent any

    environment {
        // ✅ Adjust these as needed
        WAR_NAME = "App02.war"
        TOMCAT_HOME = "C:\\Tomcat 9.0"
    }

    tools {
        // ✅ Make sure you configured Maven in Jenkins Global Tool Configuration as "Maven3"
        maven 'Maven3'
    }

    stages {

        stage('Checkout SCM') {
            steps {
                git branch: 'main', 
                    credentialsId: 'Github_username_password', 
                    url: 'https://github.com/dylandsilva688/API_Projects.git'
            }
        }

        stage('Build Maven Project') {
            steps {
                bat '''
                    echo Building the WAR file...
                    mvn clean package -DskipTests
                '''
            }
        }

        stage('Deploy to Tomcat') {
            steps {
                bat '''
                    echo ========== DEPLOYING TO TOMCAT ==========
                    
                    REM Kill any running Tomcat process
                    taskkill /F /IM java.exe || echo Tomcat not running

                    REM Remove old WAR and exploded app folder
                    if exist "%TOMCAT_HOME%\\webapps\\App02.war" del /Q "%TOMCAT_HOME%\\webapps\\App02.war"
                    if exist "%TOMCAT_HOME%\\webapps\\App02" rmdir /S /Q "%TOMCAT_HOME%\\webapps\\App02"

                    REM Copy new WAR file to Tomcat webapps directory
                    if exist "target\\%WAR_NAME%" (
                        xcopy /Y "target\\%WAR_NAME%" "%TOMCAT_HOME%\\webapps\\"
                        echo WAR copied successfully.
                    ) else (
                        echo ERROR: WAR file not found in target folder!
                        exit /b 1
                    )

                    REM Start Tomcat
                    start "" "%TOMCAT_HOME%\\bin\\startup.bat"

                    REM Wait 10 seconds to allow Tomcat to start
                    ping 127.0.0.1 -n 10 >nul

                    echo ========== DEPLOYMENT COMPLETE ==========
                '''
            }
        }
    }

    post {
        success {
            echo '✅ Deployment successful! Access your app at http://localhost:8181/App02/'
        }
        failure {
            echo '❌ Deployment failed. Check Jenkins logs for details.'
        }
    }
}
























