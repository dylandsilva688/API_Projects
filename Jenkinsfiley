pipeline {
    agent any

    environment {
        WAR_NAME = "App02.war"
        TOMCAT_HOME = "C:\\Tomcat 9.0"
    }

    tools {
        maven 'apache-maven-3.9.5'
    }

    stages {
        stage('Clone the repository') {
            steps {
                git branch: 'main', credentialsId: 'Github_username_password', url: 'https://github.com/dylandsilva688/API_Projects.git'
            }
        }

        stage('Build the Maven code') {
            steps {
                bat 'mvn clean package'
            }
        }

        stage('Deploy to Tomcat') {
            steps {
                bat """
                echo Deploying ${WAR_NAME} to Tomcat...

                REM Stop Tomcat service
                net stop Tomcat9

                REM Remove old WAR and exploded folder if they exist
                if exist "%TOMCAT_HOME%\\webapps\\${WAR_NAME}" del /Q "%TOMCAT_HOME%\\webapps\\${WAR_NAME}"
                if exist "%TOMCAT_HOME%\\webapps\\App02" rmdir /S /Q "%TOMCAT_HOME%\\webapps\\App02"

                REM Copy new WAR from Maven target
                if exist "target\\${WAR_NAME}" (
                xcopy /Y "target\\${WAR_NAME}" "%TOMCAT_HOME%\\webapps\\"
                ) else (
                    echo ERROR: WAR file not found!
                    exit /b 1
                )

                REM Start Tomcat service
                net start Tomcat9

                REM Optional: wait 10 seconds to let Tomcat deploy
                timeout /t 10
                """
            }
        }
    }
}




























